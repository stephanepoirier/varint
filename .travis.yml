dist: trusty
language: cpp
addons:
  apt:
    sources:
      - george-edison55/cmake-3.x
    packages:
      - cmake
env:
  - LCOV_FILE="coverage-all.info"
compiler:
  - gcc
before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y lcov
install:
  # install latest LCOV >= 1.12
  - wget https://github.com/linux-test-project/lcov/releases/download/v1.13/lcov-1.13.tar.gz
  - tar xf lcov-1.13.tar.gz
  - sudo make -C lcov-1.13/ install
  - gem install coveralls-lcov
script:
  - mkdir install && mkdir build && cd build
  - cmake -DCMAKE_INSTALL_PREFIX="../install" -DCMAKE_BUILD_TYPE=Debug -DVARINT_TESTS=ON -DVARINT_COVERAGE=ON -DVARINT_LCOV_OUTPUT_FILE=${LCOV_FILE} ..
  - make
  - make test
  - make coverage
  - make install
after_success:
  - coveralls-lcov --repo-token ${COVERALLS_TOKEN} ${LCOV_FILE}
